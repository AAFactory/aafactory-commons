<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <link rel="stylesheet" href="./resources/prism/prism.css" type="text/css">
    <link rel="stylesheet" href="./css/ol.css" type="text/css">
    <script src="./resources/jquery-3.3.1.min.js"></script>
    <title>Vector Layer</title>
    
    <style>
       #map { height:100%; margin: 0 }
       html, body { height:100%; border:0; margin:0; font-family: monospace; } 
       #toolDiv {
         position: absolute;
         top: 10px;
         right: 10px; 
         font-size: 13px;
         z-index: 10;
       }
       select { background: white; border: 0px; padding: 5px; display: block; width: 200px; }
       .legend {
         width: 80px;
         vertical-align: middle;
         text-align: right;
         padding: 5px 5px;
         z-index: 10;
         cursor: pointer;
       }
       #highway {
         background: #00FF00;
       }
       #localRoad {
         background: #ffbc66;
       }
       span { font-size: 10px; color: white; }
       #nRoadSelect {  }
       #switchEMD {
         top: 118px;
         background: darkgrey;
       }
       #legend {
         float: right;
         margin-top: 5px;
       }
       .mapInfo {
         text-align: center;
         color: black;
         display: block;
       }
       #selectOpttions {
         display: none;
         margin-top: 5px;
       }
       #xAxis {
         background-color: red;
         position: absolute;
         width: 20px;
         height: 2px;
         top: calc((100% / 2) - 1px);
         left: calc((100% / 2) - 10px);
       }
       #yAxis {
         background-color: red;
         position: absolute;
         width: 2px;
         height: 20px;
         top: calc((100% / 2) - 10px);
         left: calc((100% / 2) - 1px);
       }
       #buttonDiv {
         position: absolute;
         top: 10px;
         left: 10px;
         z-index: 10;
       }
       #infoDiv{
         position: fixed;
         top: 5px;
         width: 100%;
         text-align: center;
       }
       .button {
         background: black;
         color: white;
         font-size: 10px;
         padding: 5px;
         display: block;
         cursor: pointer;
       }
    </style>
    
    <script type="text/javascript">
      let labelMap = {
        sgg: 'SIG_KOR_NM'		
      }
      
      var focusLayer;
    
      function toggleOptionsDiv() {
        $('#selectOpttions').toggle();
      }
      
      function fitboundsLayer(element) {
      	element.blur();
        var map = window.map;
        var featureOverlay = window.featureOverlay;
      	map.getView().fit(map.getLayers().item(4).getLayers().item(element.value).getSource().getExtent(), map.getSize());
        //console.log(map.getLayers().item(element.value).get('name'));
        
        var targetLayer = map.getLayers().item(4).getLayers().item(element.value).getSource().getFeatures()[0];
        if (focusLayer) featureOverlay.getSource().removeFeature(focusLayer);
        featureOverlay.getSource().addFeature(targetLayer);
        focusLayer = targetLayer;
      }
      
      function fitboundsNRoadLayer(element) {
      	element.blur();
        var map = window.map;
        var featureOverlay = window.featureOverlay;
        map.getView().fit(map.getLayers().item(5).getLayers().item(element.value).getSource().getExtent(), map.getSize());
        //console.log(map.getLayers().item(element.value).get('name'));
        
        var targetLayer = map.getLayers().item(5).getLayers().item(element.value).getSource().getFeatures()[0];
        if (focusLayer) featureOverlay.getSource().removeFeature(focusLayer);
        featureOverlay.getSource().addFeature(targetLayer);
        focusLayer = targetLayer;
      }
      
      function toggleRoadLayer(index) {
      	var map = window.map;
      	map.getLayers().item(index).getLayers().forEach(function(layer, j) {
      		layer.setVisible(!layer.getVisible());
        });
      }
      
      function toggleEMDLayer() {
      	var label = document.getElementById('switchEMD').children[0].innerText;
      	if (label == '행정동') {
      		document.getElementById('switchEMD').children[0].innerText = '법정동';
      	} else if (label == '법정동') {
      		document.getElementById('switchEMD').children[0].innerText = '행정동';
      	}
      	switchEMDLayer();
      }
      
      const sidoArr = [];
      function initSido() {
      	if (sidoArr.length == 0) {
          map.getLayers().item(0).getLayers().forEach(function(layer) { 
          	sidoArr.push(layer);
          });
          
          $.each(sidoArr, function(idx, layer) {
          	$('#sidoSelect').append($('<option>', {
              value: idx,
              text: layer.getSource().getFeatures()[0].get('area1')
            }));
          });
          
          $('#sidoSelect').on('change', function() {
            map.getView().fit(sidoArr[$(this).val()].getSource().getExtent(), map.getSize());
          });
      	}
      }
      
      const sggArr = [];
      function initSgg() {
        if (sggArr.length == 0) {
          map.getLayers().item(1).getLayers().forEach(function(layer) {
            layer.getSource().getFeatures().forEach(function(feature) {
              //hEmdArr.push(feature.get('adm_nm'));
              sggArr.push(feature);
            });
          });
            
          $.each(sggArr, function(idx, feature) {
          	$('#sggSelect').append($('<option>', {
              value: idx,
              text: feature.get(labelMap.sgg)
            }));
          }); 
          
          $('#sggSelect').on('change', function() {
            map.getView().fit(sggArr[$(this).val()].getGeometry().getExtent(), map.getSize());
          });
        }
      }
      
      const hEmdArr = [];
      function initHEmd() {
        if (hEmdArr.length == 0) {
          var a = "<select id='hEmdSelect'>";
          map.getLayers().item(2).getLayers().forEach(function(layer) {
          	layer.getSource().getFeatures().forEach(function(feature) {
          		//hEmdArr.push(feature.get('adm_nm'));
          		hEmdArr.push(feature);
          	});
          });
          	
          $.each(hEmdArr, function(idx, feature) {
          	 a += "<option value='" + idx + "'>" + feature.get('adm_nm') + "</option>"
          });	
          a += "</select>";
          if (hEmdArr.length > 0) $('#selectOpttions').append(a);
          
          $('#hEmdSelect').on('change', function() {
            map.getView().fit(hEmdArr[$(this).val()].getGeometry().getExtent(), map.getSize());
          });
        }
      }
      
      function printSggName() {
      	map.getLayers().item(1).getLayers().forEach(function(layer) { 
      		layer.getSource().getFeatures().forEach(function(feature) { 
      			console.log(feature.get('SIG_KOR_NM'))
      		}) 
      	});
      }
      
      function printHEmdName() {
      	map.getLayers().item(2).getLayers().forEach(function(layer) { 
          layer.getSource().getFeatures().forEach(function(feature) { 
            console.log(feature.get('adm_cd'), feature.get('adm_nm'))
          }) 
        });
      }
      
      function printBEmdName() {
      	map.getLayers().item(3).getLayers().forEach(function(layer) { 
          layer.getSource().getFeatures().forEach(function(feature) { 
            console.log(feature.get('EMD_CD'), feature.get('EMD_KOR_NM'))
          }) 
        });
      }
      
      function updateMapStatus(x, y, z) {
      	$('#mapStatus').html(x.toFixed(2) + ' ' + y.toFixed(2) + ' ' + z.toFixed(2));
      }
      
      function updateAreaName(areaName) {
        $('#areaName').html(areaName);
      }
      
      $(function() {
      	$('.button').on('click', function() {
      		if ($(this).hasClass('a')) {
      			toggleOptionsDiv();
      			initSido();
      			initHEmd();
      		} else if ($(this).hasClass('b')) {
      			toggleRoadLabel();
      		} else if ($(this).hasClass('c')) {
            initSgg();
            initHEmd();
      		}
      		
      	});
      });
    </script>
  </head>
  <body>
    <div id="map" class="map"></div>
    <div id="toolDiv">
      <div id="legend">
        <div class="legend" onclick="toggleRoadLayer(4);" id="highway"><span>고속도로</span></div>
        <div class="legend" onclick="toggleRoadLayer(5);" id="localRoad"><span>지방도, 국도</span></div>
        <div class="legend" onclick="toggleEMDLayer();" id="switchEMD"><span>행정동</span></div>
      </div>
      <div id="selectOpttions">
        <select onchange="fitboundsLayer(this);">
          <option value="" disabled selected>고속도로</option>
          <option value="0">경부고속도로</option>
          <option value="1">호남고속도로</option>
          <option value="2">중부고속도로</option>
          <option value="3">통영대전고속도로</option>
          <option value="4">중부내륙고속도로</option>
          <option value="5">제2중부고속도로</option>
          <option value="6">중부내륙고속도로지선</option>
          <option value="7">서울양양고속도로</option>
          <option value="8">영동고속도로</option>
          <option value="9">경인고속도로</option>
          <option value="10">광주원주고속도로</option>
          <option value="11">세종포천고속도로(구리-포천)</option>
          <option value="12">동해고속도로(부산-울산)</option>
          <option value="13">동해고속도로(삼척-속초)</option>
          <option value="14">동해고속도로(울산-포항)</option>
          <option value="15">중앙고속도로(춘천-금호)</option>
          <option value="16">서해안고속도로</option>
          <option value="17">제2경인고속도로(안양-성남)</option>
          <option value="18">제2경인고속도로(인천대교)</option>
          <option value="19">중앙고속도로(부산-대구)</option>
        </select>
        <select id="nRoadSelect" onchange="fitboundsNRoadLayer(this);">
          <option value="" disabled selected>국도</option>
          <option value="0">내부순환로</option>
          <option value="1">분당수서간도시고속화도로</option>
          <option value="2">서울외곽순환고속도로</option>
        </select>
        <select id='sidoSelect'></select>
        <select id='sggSelect'></select>
      </div>
    </div>
    <div id="xAxis"></div>
    <div id="yAxis"></div>
    <div id="buttonDiv">
      <div class="button a">OPT</div>
      <div class="button b">LAB</div>
      <div class="button c">UPD</div>
    </div>
    <div id="infoDiv">
      <div id="mapStatus" class="mapInfo"></div>
      <div id="areaName" class="mapInfo"></div>
    </div>
    
  </body>
  <script src="./resources/common.js"></script>
  <script src="./resources/prism/prism.min.js"></script>
  <script src="common.js"></script>
  <script src="vector-layer.js"></script>
</html>
